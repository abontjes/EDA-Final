---
title: "EDA Final"
author: "Andrew Bontjes"
date: "12/8/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
# data cleaning and formatting

#import packages
library(dplyr)
library(stringr)
library(tidyr)
library(ggplot2)
library(corrplot)

# import data and remove unnecessary columns change date format
library(readr)
sd <- read_csv("spotify_dataset.csv", 
    col_types = cols(`Release Date` = col_date(format = "%Y-%m-%d"), 
        `Weeks Charted` = col_skip(),
        `Index` = col_skip()))

#get rid of spaces in columns with stringr package
names(sd)<-str_replace_all(names(sd), c(" " = "."))

#Get rid of values with empty values
sd <- na.omit(sd)

# Change Chord and Song.ID to factor data type
sd$Chord <- as.factor(sd$Chord)
str(sd$Chord)

sd$Song.ID <- as.factor(sd$Song.ID)

# Set Week of highest charting to usable date format
sd$Week.of.Highest.Charting <- sapply(strsplit(sd$Week.of.Highest.Charting, "--"), head, 1)
sd$Week.of.Highest.Charting <- as.Date(sd$Week.of.Highest.Charting, format = "%Y-%m-%d")

# Reformat genre column to one only first genre
sd$Genre <- gsub(",.*", "", sd$Genre)
sd$Genre <- gsub(",.*|\\].*", "", sd$Genre)
sd$Genre <- gsub(",.*|\\].*", "", sd$Genre)
sd$Genre <- gsub(",.*|\\].*|\\[", "", sd$Genre)
sd$Genre <- gsub("'", '', sd$Genre)

sd$Genre <- as.factor(sd$Genre)


#check the summary of the data
summary(sd)
str(sd$Genre)

colnames(sd)[colnames(sd) == 'Duration.(ms)'] <- 'Duration.ms'

```

```{r}
# create dataset totaling number of streams for songs that appear multiple times

# df of distinct song ids
sdu <- sd %>% distinct(Song.ID, .keep_all = TRUE )

# df of distinct song ids without stream column
sdu <- subset(sdu, select = -c(Streams))

# df of song id and stream sum
stream_sum <- aggregate(Streams ~ Song.ID, sd, sum)

# df with no duplicates of song id and summed stream number
sd_no_dup <- merge(sdu, stream_sum, by = "Song.ID")

# correlation matrix of numeric variables with no duplicates
sdnd <- subset(sd_no_dup, select = -c(Week.of.Highest.Charting , Song.ID , Artist,  Song.Name , Genre ,
                                      Release.Date , Chord ))
sdndc <- cor(as.matrix(sdnd))

sd_corr <- corrplot(sdndc, method = 'circle')

#investigate genre column (no duplicate song id)

#subset with top 10 genres
sdndg <- subset(sd_no_dup, Genre == "dance pop" | Genre == "latin" | Genre == "pop" | Genre == "atl hip hop" | 
                Genre == "hip hop" | Genre == "k-pop" | Genre == "melodic rap" | 
                Genre == "brooklyn drill" | Genre == "chicago rap" | Genre == "canadian pop" )

ggplot(sdndg, aes(Genre)) + geom_bar() + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))



```

```{r}
# turn artists into factor data type
sd_no_dup$Artist <- as.factor(sd_no_dup$Artist)
str(sd_no_dup$Artist)

# view frequency of artists
at <- table(sd_no_dup$Artist)
at <- sort(at, decreasing = TRUE)

# subset table to top 10 most frequent artists
at2 <- head(at, 10)
at2 <- as.matrix(at2)
at2 <- at2[,0] 
at2

# subset the data to top 10 artists and find their mean spotify metrics
ASM <- subset(sd_no_dup, Artist == "Taylor Swift" | Artist == "Justin Bieber" | Artist == "Lil Uzi Vert"
              | Artist == "Juice WRLD" | Artist == "BTS" | Artist == "Pop Smoke"
              | Artist == "Bad Bunny" | Artist == "Eminem" | Artist == "The Weeknd"
              | Artist == "Drake")

ASMax <- aggregate(cbind( Number.of.Times.Charted, Artist.Followers)
                   ~ Artist, data = ASM, FUN = max)

ASMin <- aggregate( Highest.Charting.Position ~ Artist, data = ASM, FUN = min)

ASMean <- aggregate(cbind(Popularity, Danceability, Energy, Loudness, Speechiness, Acousticness,
                          Liveness, Tempo, Valence, Duration.ms,  Streams) ~ Artist, data = ASM, FUN = mean)

TopArtists <- merge(ASMin, ASMax, by = 'Artist')
TopArtists <- merge(TopArtists, ASMean, by = 'Artist')
View(TopArtists)

str(ASM$Genre)

```









